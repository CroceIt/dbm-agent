#!/usr/bin/evn python3

import os
import sys
import argparse
from dbma.daemon import start_daemon,stop_daemon
from dbma import server
from dbma import __dbma_version
from dbma import initialization

def parser_cmd_args():
    parser = argparse.ArgumentParser(f'dbma-agent {__dbma_version}')
    parser.add_argument('--dbmc-site',type=str,default="https://192.168.100.100",help='dbm-center url')
    parser.add_argument('--base-dir',type=str,default="/usr/local/dbm-agent/",help='dbm-agent work dir')
    parser.add_argument('--config-file',type=str,default="etc/dbma.cnf",help="dbm-agent config file")
    parser.add_argument('--log-file',type=str,default="logs/dbma.log",help="dbm-agent log file")
    parser.add_argument('--log-level',type=str,default="info",choices=['info','debug','error'])
    parser.add_argument('--user-name',type=str,default="dbma",help="user")
    parser.add_argument('--pid',type=str,default="/tmp/dbm-agent.pid",help="pid file")
    parser.add_argument('--net-if',type=str,default="ens33",help="if es eth0,eth1,ens33")
    parser.add_argument('--heartbeat-api',type=str,default="hosts/heatheat",help="heartbeat http interface")
    parser.add_argument('--heartbeat-interval',type=int,default=5,help="the interval between heartbeat")
    parser.add_argument('action',type=str,default='start',choices=('init','start','stop','version'),help='')
    args = parser.parse_args()
    return args


def main():
    args = parser_cmd_args()
    
    if args.action == 'init':
        initialization.init(args)
    elif args.action == 'start':
        server.start(args)
    elif args.action == 'version':
        print(f'dbma-agent {__dbma_version}')
    elif args.action == 'stop':
        stop_daemon(args.pid)
    
    

if __name__ == "__main__":
    main()


















